{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <div class="card shadow mb-4">
        <div class="card-header bg-dark d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <img class="rounded-circle me-2" src="{{url_for('static', filename='profile_pics/' + other_user.image_file)}}" width="40" height="40" alt="Profile picture">
                <h3 style="color: #8a2be2">{{ other_user.username }}</h3>
            </div>
            <form method="POST" action="{{ url_for('toggle_block', user_id=other_user.id) }}">
                {{form.hidden_tag()}}
                {% if is_blocked %}
                    <button class="btn btn-secondary" type="submit"><i class="fas fa-unlock me-1"></i>Unblock</button>
                {% else %}
                    <button class="btn btn-outline-danger" type="submit"><i class="fas fa-user-slash me-1"></i>Block</button>
                {% endif %}
            </form>
        </div>
        
        {% if is_blocked %}
        <div class="alert alert-warning m-3 mb-0">
            <i class="fas fa-exclamation-triangle me-2"></i>You have blocked this user. Unblock to continue messaging.
        </div>
        {% endif %}
        
        <div class="card-body chat-container" style="height: 400px; overflow-y: auto; background-color: #151515; padding: 1.5rem;">
            {% if is_blocked %}
                <div></div>
            {%else%}

            {% for msg in messages %}
                {% if msg.sender_id == current_user.id %}
                    <div class="d-flex justify-content-end mb-3">
                        <div class="message sent">
                            <div class="message-content">{{ msg.content }}</div>
                            <small class="message-time">{{ msg.timestamp.strftime('%H:%M') }}</small>
                        </div>
                    </div>
                {% else %}
                   
                    <div class="d-flex justify-content-start mb-3">
                        <div class="message received">
                            <div class="message-content">{{ msg.content }}</div>
                            <small class="message-time">{{ msg.timestamp.strftime('%H:%M') }}</small>
                        </div>
                    </div>
                    
                {% endif %}
            {% else %}
                <div class="text-center text-muted py-5">
                    <i class="fas fa-comments fa-3x mb-3"></i>
                    <p>No messages yet. Start the conversation!</p>
                </div>
            {% endfor %}
            {%endif%}
        </div>
        
        <div class="card-footer bg-dark p-3">
           
            
            <form method="POST" enctype="multipart/form-data" class="message-form">
                {{form.hidden_tag() }}
                <div class="input-group">
                    <input type="text" name="message" class="form-control" placeholder="Type your message..." required {% if is_blocked %}disabled{% endif %}>
                    <button class="btn btn-primaryy" type="submit" {% if is_blocked %}disabled{% endif %}>
                        <i class="fas fa-paper-plane me-1"></i>Send
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="mt-3">
        <a href="{{ url_for('messages_dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Back to Messages
        </a>
    </div>
</div>

<style>
/* Chat-specific styles */
.message {
    max-width: 70%;
    padding: 10px 15px;
    border-radius: 18px;
    position: relative;
    margin-bottom: 5px;
    word-break: break-word;
}

.message.sent {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: #fff;
    border-bottom-right-radius: 5px;
    box-shadow: 0 2px 5px rgba(138, 43, 226, 0.3);
}

.message.received {
    background-color: #2a2a2a;
    color: var(--text-primary);
    border-bottom-left-radius: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.message-content {
    font-size: 0.95rem;
    line-height: 1.4;
}

.message-time {
    display: block;
    font-size: 0.7rem;
    opacity: 0.8;
    margin-top: 3px;
    text-align: right;
}

.chat-container::-webkit-scrollbar {
    width: 6px;
}

.chat-container::-webkit-scrollbar-thumb {
    background-color: var(--accent-secondary);
    border-radius: 10px;
}

.message-form .input-group {
    box-shadow: 0 -5px 10px -5px rgba(0, 0, 0, 0.1);
}

.message-form .form-control {
    border-radius: 20px 0 0 20px;
    padding-left: 15px;
}

.message-form .btn {
    border-radius: 0 20px 20px 0;
}
</style>

{% endblock %}